<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pré-Cadastro Natação</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        body {
            background: #e3f2fd;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
            padding: 30px;
            margin: 20px 0;
        }
        .logo {
            text-align: center;
            margin-bottom: 25px;
        }
        .logo-text {
            font-size: 28px;
            font-weight: 800;
            color: #006064;
            line-height: 1.2;
            text-transform: uppercase;
            margin: 0;
        }
        .logo-subtext {
            font-size: 16px;
            color: #00838f;
            letter-spacing: 3px;
            margin-top: 5px;
            display: block;
        }
        h1 {
            color: #006064;
            text-align: center;
            margin-bottom: 30px;
            font-size: 22px;
        }
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .btn-option {
            background: #00838f;
            color: white;
            border: none;
            padding: 15px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        .btn-option:hover {
            background: #006064;
            transform: translateY(-2px);
        }
        .form-page {
            display: none;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        .required::after {
            content: " *";
            color: #d32f2f;
        }
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #b0bec5;
            border-radius: 6px;
            font-size: 16px;
        }
        button[type="submit"] {
            background: #00838f;
            color: white;
            border: none;
            padding: 15px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: background 0.3s;
        }
        button[type="submit"]:hover {
            background: #006064;
        }
        .senha-gerada {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: #e8f5e9;
            border-radius: 8px;
            font-size: 18px;
        }
        .senha-numero {
            font-size: 28px;
            font-weight: bold;
            color: #2e7d32;
            margin: 10px 0;
        }
        .voltar-btn {
            background: #b0bec5;
            margin-top: 15px;
        }
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @media (max-width: 600px) {
            .logo-text { font-size: 24px; }
            .logo-subtext { font-size: 14px; }
            .container { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Logo -->
        <div class="logo">
            <h1 class="logo-text">ESCOLINHA</h1>
            <span class="logo-subtext">DE NATAÇÃO</span>
        </div>

        <!-- Página 1: Seleção do Tipo -->
        <div id="page1">
            <h1>Selecione o Tipo de Natação</h1>
            <div class="btn-group">
                <button class="btn-option" onclick="selectType('Infantil')">Infantil (8-12 anos)</button>
                <button class="btn-option" onclick="selectType('Adolescente')">Adolescente (13-17 anos)</button>
                <button class="btn-option" onclick="selectType('Adulto')">Adulto (18+ anos)</button>
            </div>
        </div>

        <!-- Página 2: Formulários -->
        <div id="page2" style="display:none;">
            <h1 id="form-title">Pré-Cadastro</h1>
            
            <!-- Formulário Infantil -->
            <form id="form-Infantil" class="form-page">
                <div class="form-group">
                    <label for="i-nome" class="required">Nome da Criança</label>
                    <input type="text" id="i-nome" name="nome" required>
                </div>
                <div class="form-group">
                    <label for="i-responsavel" class="required">Responsável</label>
                    <input type="text" id="i-responsavel" name="responsavel" required>
                </div>
                <div class="form-group">
                    <label for="i-idade" class="required">Idade</label>
                    <input type="number" id="i-idade" name="idade" min="8" max="12" required>
                </div>
                <div class="form-group">
                    <label for="i-telefone" class="required">Telefone/WhatsApp</label>
                    <input type="tel" id="i-telefone" name="telefone" required>
                </div>
                <div class="form-group">
                    <label for="i-tel-responsavel" class="required">Telefone do Responsável</label>
                    <input type="tel" id="i-tel-responsavel" name="tel_responsavel" required>
                </div>
                <button type="submit">Concluir Cadastro</button>
            </form>

            <!-- Formulário Adolescente -->
            <form id="form-Adolescente" class="form-page">
                <div class="form-group">
                    <label for="a-nome" class="required">Nome do Adolescente</label>
                    <input type="text" id="a-nome" name="nome" required>
                </div>
                <div class="form-group">
                    <label for="a-responsavel" class="required">Responsável</label>
                    <input type="text" id="a-responsavel" name="responsavel" required>
                </div>
                <div class="form-group">
                    <label for="a-idade" class="required">Idade</label>
                    <input type="number" id="a-idade" name="idade" min="13" max="17" required>
                </div>
                <div class="form-group">
                    <label for="a-telefone" class="required">Telefone/WhatsApp</label>
                    <input type="tel" id="a-telefone" name="telefone" required>
                </div>
                <div class="form-group">
                    <label for="a-tel-responsavel" class="required">Telefone do Responsável</label>
                    <input type="tel" id="a-tel-responsavel" name="tel_responsavel" required>
                </div>
                <button type="submit">Concluir Cadastro</button>
            </form>

            <!-- Formulário Adulto -->
            <form id="form-Adulto" class="form-page">
                <div class="form-group">
                    <label for="ad-nome" class="required">Nome Completo</label>
                    <input type="text" id="ad-nome" name="nome" required>
                </div>
                <div class="form-group">
                    <label for="ad-idade" class="required">Idade</label>
                    <input type="number" id="ad-idade" name="idade" min="18" required>
                </div>
                <div class="form-group">
                    <label for="ad-telefone" class="required">Telefone/WhatsApp</label>
                    <input type="tel" id="ad-telefone" name="telefone" required>
                </div>
                <button type="submit">Concluir Cadastro</button>
            </form>

            <button class="btn-option voltar-btn" onclick="backToSelection()">Voltar</button>
        </div>

        <!-- Página 3: Confirmação -->
        <div id="page3" class="senha-gerada" style="display:none;">
            <h2>Cadastro Realizado!</h2>
            <p>Sua senha de identificação é:</p>
            <div class="senha-numero" id="senha-display"></div>
            <p>Apresente esta senha na unidade para finalizar seu cadastro.</p>
            <button class="btn-option" onclick="backToSelection()">Novo Cadastro</button>
        </div>
    </div>

    <script>
        // Variáveis globais
        let currentType = '';
        const scriptURL = 'https://script.google.com/macros/s/AKfycbzRvv3qFRYd6l6INhRnTodsuyj19cdHutCN0eMhpaQYTj1TC6ChQEjcAd16Vum7nwob4w/exec';

        // Máscara de telefone
        function formatPhone(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 11) value = value.substring(0, 11);
            
            if (value.length > 6) {
                value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            } else if (value.length > 2) {
                value = value.replace(/(\d{2})(\d{0,4})/, '($1) $2');
            }
            input.value = value;
        }

        // Aplica máscara a todos campos de telefone
        document.querySelectorAll('input[type="tel"]').forEach(input => {
            input.addEventListener('input', function() {
                formatPhone(this);
            });
        });

        // Seleção do tipo de cadastro
        function selectType(type) {
            currentType = type;
            document.getElementById('page1').style.display = 'none';
            document.getElementById('page2').style.display = 'block';
            
            // Atualiza título do formulário
            const titles = {
                'Infantil': 'Cadastro Infantil (8-12 anos)',
                'Adolescente': 'Cadastro Adolescente (13-17 anos)',
                'Adulto': 'Cadastro Adulto (18+ anos)'
            };
            document.getElementById('form-title').textContent = titles[type];
            
            // Mostra o formulário correto
            document.querySelectorAll('.form-page').forEach(form => {
                form.style.display = 'none';
            });
            document.getElementById(`form-${type}`).style.display = 'block';
        }

        // Voltar para seleção
        function backToSelection() {
            document.getElementById('page1').style.display = 'block';
            document.getElementById('page2').style.display = 'none';
            document.getElementById('page3').style.display = 'none';
            
            // Limpa formulários
            document.querySelectorAll('form').forEach(form => {
                form.reset();
            });
        }

        // Configura envio dos formulários - VERSÃO CORRIGIDA
        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Validação
                const inputs = this.querySelectorAll('input[required]');
                let isValid = true;
                
                inputs.forEach(input => {
                    if (!input.value.trim()) {
                        input.style.borderColor = '#d32f2f';
                        isValid = false;
                    } else {
                        input.style.borderColor = '#b0bec5';
                    }
                });
                
                if (!isValid) return alert('Preencha todos os campos obrigatórios!');

                // Gera senha (4 dígitos)
                const senha = Math.floor(1000 + Math.random() * 9000);
                
                // Prepara dados
                const formData = new FormData(this);
                const data = {
                    tipo: currentType,
                    nome: formData.get('nome'),
                    idade: formData.get('idade'),
                    telefone: formData.get('telefone').replace(/\D/g, ''),
                    responsavel: currentType !== 'Adulto' ? formData.get('responsavel') : '',
                    tel_responsavel: currentType !== 'Adulto' ? formData.get('tel_responsavel').replace(/\D/g, '') : '',
                    senha: senha // Adiciona a senha gerada
                };

                // Loading
                const btn = this.querySelector('button[type="submit"]');
                const btnText = btn.innerHTML;
                btn.innerHTML = '<div class="loading"></div> Enviando...';
                btn.disabled = true;

                try {
                    // Envia para o Google Sheets
                    const response = await fetch(scriptURL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: new URLSearchParams(data)
                    });
                    
                    // Mostra a senha independente da resposta do servidor
                    document.getElementById('page2').style.display = 'none';
                    document.getElementById('page3').style.display = 'block';
                    document.getElementById('senha-display').textContent = senha;
                    
                } catch (error) {
                    alert('Erro ao enviar: ' + error.message);
                    console.error('Detalhes do erro:', error);
                } finally {
                    btn.innerHTML = btnText;
                    btn.disabled = false;
                }
            });
        });
    </script>
</body>
</html>